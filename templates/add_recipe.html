{% extends "base.html" %}
{% block title %}Add Recipe — Chef AI{% endblock %}

{% block body %}
<div class="dashboard-hero" style="background-image: url('/static/images/dashboard_bg.jpg')">
  <div class="overlay" style="max-width:820px;">
    <header class="topbar">
      <h1 class="brand">Chef AI — Add a Recipe</h1>
      <nav class="nav">
        <a href="/">Home</a>
      </nav>
    </header>

    <main style="padding:18px;">
      {% if error %}
        <div style="color:#b91c1c;font-weight:700;margin-bottom:12px;">{{ error }}</div>
      {% endif %}
      <p>Fill the form below. Ingredients: one per line. Use <code>Ingredient|quantity</code> or <code>Ingredient - quantity</code> for quantities.</p>

      <form method="POST" action="/add_recipe" style="display:flex;flex-direction:column;gap:10px;">
        <div style="display:flex;gap:8px;">
          <input name="name" placeholder="Recipe name (e.g., Aloo Paratha (My Style))" style="flex:1;padding:10px;border-radius:8px;border:1px solid #ddd" value="{{ form.name if form else '' }}" required>
          <input name="serving_size" type="number" min="1" placeholder="Servings" value="{{ form.serving_size if form else 5 }}" style="width:110px;padding:10px;border-radius:8px;border:1px solid #ddd">
          <input name="score" type="number" min="1" max="10" placeholder="Score" value="{{ form.score if form else 5 }}" style="width:110px;padding:10px;border-radius:8px;border:1px solid #ddd">
        </div>

        <div>
          <label style="font-weight:700">Ingredients (one per line)</label>
          <textarea name="ingredients" rows="6" placeholder="Example:
Besan (cups)|2
Semolina (tbsp)|2
Salt (tsp)|1" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd">{{ form.ingredients if form else '' }}</textarea>
        </div>

        <div>
          <label style="font-weight:700">Steps (one per line)</label>
          <textarea name="steps" rows="6" placeholder="Example:
Mix dry ingredients
Add water
Steam" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd">{{ form.steps if form else '' }}</textarea>
        </div>

        <div style="display:flex;gap:8px;">
          <button class="btn" type="submit">Save recipe</button>
          <a class="btn" href="/" style="background:#94a3b8">Cancel</a>
        </div>
      </form>
    
      <section style="margin-top:18px;">
        <div class="glass" style="padding:12px; box-shadow:none; background:rgba(255,255,255,0.88);">
          <div style="font-weight:700">Your recipe history</div>
          <div style="color:#555">Total recipes: {{ total or 0 }} • Total uses: {{ total_usage or 0 }}</div>
        </div>
        {% if recipes and recipes|length > 0 %}
        <table class="ingredients-table" aria-label="Your recipes">
          <thead>
            <tr>
              <th style="width:40%">Name</th>
              <th style="width:15%">Servings</th>
              <th style="width:15%">Score</th>
              <th style="width:15%">Uses</th>
              <th style="width:15%">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for r in recipes %}
            <tr>
              <td>{{ r.name }}</td>
              <td>{{ r.serving_size }}</td>
              <td>{{ r.score }}</td>
              <td>{{ r.usage_count or 0 }}</td>
              <td>
                <form method="POST" action="/get_recipe" style="display:inline;">
                  <input type="hidden" name="dish" value="{{ r.name }}" />
                  <input type="hidden" name="servings" value="{{ r.serving_size }}" />
                  <button class="btn" type="submit" style="padding:6px 10px;">Open</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <div style="color:#555;">No recipes yet. Your saved recipes will appear here.</div>
        {% endif %}
      </section>
    </main>

    <footer class="footer" style="margin-top:12px;">
      <small>User recipes are saved to <code>user_recipes.json</code> in the project folder.</small>
    </footer>
  </div>
</div>
{% endblock %}
